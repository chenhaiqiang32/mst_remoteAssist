import{e as Je,S as Se,ac as pe,v as me,M as ye,k as Y,E as H,_ as re,u as Ye,ab as dt,ad as ut,d as mt,C as te,z as pt,as as vt,ai as Fe}from"./index.665742d2.js";/* empty css               */import{d as ie,j as C,w as ke,o as he,b as fe,C as n,aE as B,aH as O,E as e,aN as f,aI as y,D as l,aK as F,aJ as ee,F as oe,u as s,aF as D,aS as Ce,bI as _t,bH as $e,bL as ze,H as gt,a as ht,G as Ee,aW as x,ac as we,b5 as Ae,b2 as ft,b3 as bt,b9 as Ze,ag as It,aX as yt,bQ as Ct,c as $t,b8 as At,aD as Mt,bR as Tt,be as Gt,n as kt}from"./arco.638965b6.js";import{p as W,O as Ne,d as Nt,t as St}from"./icon_volume_1.148c46df.js";import{o as Et}from"./index.9de72163.js";import{S as Qe,a as je,o as wt,h as Ut,I as Dt}from"./invite.b8d9ba85.js";import{c as Me}from"./icon_close.f7fee805.js";import"./chart.ffc0c533.js";import"./vue.125da600.js";const Ot="/assist/assets/no_chat.3fc2e4cf.png",Rt={class:"chat-panel-top"},Bt={class:"chat-panel-top-left"},Lt={class:"chat-panel-top-right"},Ht={key:0,class:"chat-panel-content wsl-scroll"},xt=["onClick"],Pt={class:"chat-panel-content-item-left"},Vt=["src"],Ft={class:"chat-panel-content-item-right",fill:""},Qt={class:"chat-panel-content-item-right-top"},jt={class:"chat-panel-content-item-right-top-name textEllipsis"},Jt={class:"chat-panel-content-item-right-top-time"},Yt={class:"chat-panel-content-item-right-bot"},zt={class:"chat-panel-content-item-right-bot-left"},Zt={key:0,class:"chat-panel-content-item-right-bot-right"},Kt={key:1,class:"no-data"},qt={class:"no-data-body"},Xt=["src"],Wt={class:"no-data-body-text"},es="ChatDB",ts=ie({__name:"chat",setup(Q){const{getAllConversations:E,updateConversations:G}=Je(es),c=Se(),A=pe(),m=C(c.conversationList),{t:M}=me.exports.useI18n(),d=C({condition:""}),t=N=>{const{messageType:p,content:a,name:h,targetName:J}=N;try{if(p===ye.SYSTEM){const g=JSON.parse(a),{eventType:$,eventData:u}=g;switch($){case Y.CHAT_GROUP_CREATED:{const _=u.masterName||A.filterMemberInfoByUserId(u.masterId).name,I=u.names||W(u.userIds.map(z=>A.memberList.find(se=>se.userId===z)).filter(Boolean),"name").join("\u3001");return`${_} ${M("message.invite.join.group.menu.invite")} ${I} ${M("message.chat.room.message.tips.create.group2")}`}case Y.CHAT_GROUP_INFO_UPDATED:return`${u.updatedName||A.filterMemberInfoByUserId(u.updateUserId).name} ${M("message.chat.room.message.tips.update.group")}`;case Y.CHAT_GROUP_MEMBER_INVITED:{const _=u.invitorName||A.filterMemberInfoByUserId(u.invitorUserId).name,I=u.inviteeNames||W(u.inviteeUserIds.map(z=>A.memberList.find(se=>se.userId===z)).filter(Boolean),"name").join("\u3001");return`${_} ${M("message.chat.room.message.tips.invite.group")} ${I} ${M("message.chat.room.message.tips.invite.group2")}`}case Y.CHAT_GROUP_MEMBER_REMOVED:{const _=u.masterName||A.filterMemberInfoByUserId(u.masterId).name,I=u.removedNames||W(u.removedUserIds.map(z=>A.memberList.find(se=>se.userId===z)).filter(Boolean),"name").join("\u3001");return`${_} ${M("message.chat.room.message.tips.remove.group")} ${I}`}case Y.CHAT_GROUP_MEMBER_QUIT:return`${u.quitName||A.filterMemberInfoByUserId(u.quitUserId).name} ${M("message.chat.room.message.tips.quit.group")}`;case Y.CHAT_GROUP_MASTER_CHANGED:{const _=u.oldMasterName||A.filterMemberInfoByUserId(u.oldMasterId).name,I=u.newMasterName||A.filterMemberInfoByUserId(u.newMasterId).name;return`${_} ${M("message.chat.room.message.tips.change.group")} ${I}`}case Y.CHAT_GROUP_DISBANDED:return`${u.masterName||A.filterMemberInfoByUserId(u.masterId).name} ${M("message.chat.room.message.tips.disbanded.group")}`;default:return g}}else return a}catch{return`${h} \u9080\u8BF7 ${J} \u52A0\u5165\u4E86\u7FA4\u804A`}},r=N=>{const p=Ce(),a=Ce(N),h=a.format("YYYY-MM-DD HH:mm");return a.isSame(p,"day")?`${M("today")} ${a.format("HH:mm")}`:a.isSame(p.add(1,"day"),"day")?`${M("tomorrow")} ${a.format("HH:mm")}`:a.isSame(p.subtract(1,"day"),"day")?`${M("yesterday")} ${a.format("HH:mm")}`:h},v=async()=>{m.value=await E(),c.updateConversationList(m.value),console.log("handleGetConversationList1",m.value)},U=()=>{if(!d.value.condition)return c.conversationList;const N=d.value.condition.toLowerCase();return c.conversationList.filter(p=>p.targetName.toLowerCase().includes(N)||p.content.toLowerCase().includes(N))},k=()=>{m.value=U()},R=()=>{c.groupChatSettingVisible&&c.updateGroupChatSettingVisible(!1)},P=async N=>{N&&(N.unreadCount=0,G(N),c.updateCurConversation(Ne(N)),H.emit("ChatConversationRead",N)),R()},V=()=>{P(c.curConversation)},K=()=>{H.on("group-info-change",v),H.on("send-refresh-chat-room",v),H.on("event-exit-group-chat",V),H.on("event-disband-group-chat",V)},T=()=>{H.off("group-info-change",v),H.off("send-refresh-chat-room",v),H.off("event-exit-group-chat",V),H.off("event-disband-group-chat",V)};return ke(()=>c.conversationList,()=>{k()},{deep:!0,immediate:!0}),he(async()=>{v(),K()}),fe(()=>{T()}),(N,p)=>{const a=_t,h=$e,J=ze;return n(),B(J,{class:"general-card chat-panel",bordered:!1,"body-style":{height:"100%",display:"flex",padding:0,flexFlow:"column"}},{default:O(()=>[e("div",Rt,[e("div",Bt,[e("span",null,f(N.$t("message.chat.title")),1)]),e("div",Lt,[y(a,{modelValue:d.value.condition,"onUpdate:modelValue":p[0]||(p[0]=g=>d.value.condition=g),style:{width:"100%"},placeholder:N.$t("message.chat.search"),onInput:k},null,8,["modelValue","placeholder"])])]),y(h,{margin:0}),m.value&&m.value.length>0?(n(),l("div",Ht,[(n(!0),l(F,null,ee(m.value,(g,$)=>{var u;return n(),l("div",{key:`group_${$}`,class:oe(["chat-panel-content-item",((u=s(c).curConversation)==null?void 0:u.conversationId)===g.conversationId?"active":""]),onClick:_=>P(g)},[e("div",Pt,[e("img",{src:g.targetAvatarUrl,alt:""},null,8,Vt)]),e("div",Ft,[e("div",Qt,[e("div",jt,f(g.targetName),1),e("div",Jt,f(r(g.sendTime)),1)]),e("div",Yt,[e("div",zt,f(t(g)),1),g.unreadCount>0?(n(),l("div",Zt,[e("span",null,f(g.unreadCount),1)])):D("",!0)])])],10,xt)}),128))])):(n(),l("div",Kt,[e("div",qt,[e("img",{src:s(Ot),alt:""},null,8,Xt),e("div",Wt,f(N.$t("meeting.no.data.text")),1)])]))]),_:1})}}});const ss=re(ts,[["__scopeId","data-v-3315f7b9"]]);const ns={width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},os=e("g",{stroke:"#314669","stroke-width":"1.5"},[e("path",{d:"M21.97 18.33c0 .36-.08.73-.25 1.09-.17.36-.39.7-.68 1.02-.49.54-1.03.93-1.64 1.18-.6.25-1.25.38-1.95.38-1.02 0-2.11-.24-3.26-.73s-2.3-1.15-3.44-1.98a28.75 28.75 0 0 1-3.28-2.8 28.414 28.414 0 0 1-2.79-3.27c-.82-1.14-1.48-2.28-1.96-3.41C2.24 8.67 2 7.58 2 6.54c0-.68.12-1.33.36-1.93.24-.61.62-1.17 1.15-1.67C4.15 2.31 4.85 2 5.59 2c.28 0 .56.06.81.18.26.12.49.3.67.56l2.32 3.27c.18.25.31.48.4.7.09.21.14.42.14.61 0 .24-.07.48-.21.71-.13.23-.32.47-.56.71l-.76.79c-.11.11-.16.24-.16.4 0 .08.01.15.03.23.03.08.06.14.08.2.18.33.49.76.93 1.28.45.52.93 1.05 1.45 1.58.54.53 1.06 1.02 1.59 1.47.52.44.95.74 1.29.92.05.02.11.05.18.08.08.03.16.04.25.04.17 0 .3-.06.41-.17l.76-.75c.25-.25.49-.44.72-.56.23-.14.46-.21.71-.21.19 0 .39.04.61.13.22.09.45.22.7.39l3.31 2.35c.26.18.44.39.55.64.1.25.16.5.16.78Z","stroke-miterlimit":"10"}),e("path",{d:"M18.5 9c0-.6-.47-1.52-1.17-2.27-.64-.69-1.49-1.23-2.33-1.23M22 9c0-3.87-3.13-7-7-7","stroke-linecap":"round","stroke-linejoin":"round"})],-1),as=[os];function rs(Q,E){return n(),l("svg",ns,[...as])}const is={render:rs},ls={width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cs=gt('<g stroke="#314769" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10ZM3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37"></path><path d="M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67Z" stroke-miterlimit="10"></path><g stroke-miterlimit="10"><path d="M19.492 17.98h-2.98M18 16.52v2.99"></path></g></g>',1),ds=[cs];function us(Q,E){return n(),l("svg",ls,[...ds])}const ms={render:us},ps={width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},vs=e("g",{stroke:"#314669","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9 22h6c5 0 7-2 7-7V9c0-5-2-7-7-7H9C4 2 2 4 2 9v6c0 5 2 7 7 7Z"}),e("path",{d:"M15.57 18.5v-3.9M15.57 7.45V5.5M15.569 12.65a2.6 2.6 0 1 0 0-5.2 2.6 2.6 0 0 0 0 5.2ZM8.43 18.5v-1.95M8.43 9.4V5.5M8.428 16.55a2.6 2.6 0 1 0 0-5.2 2.6 2.6 0 0 0 0 5.2Z","stroke-miterlimit":"10"})],-1),_s=[vs];function gs(Q,E){return n(),l("svg",ps,[..._s])}const hs={render:gs},fs="/assist/assets/no_message.49d2ffdd.png",bs={width:"56",height:"44",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Is=e("rect",{width:"56",height:"44",rx:"4",fill:"#165DFF"},null,-1),ys=e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M37.334 23.273a3.001 3.001 0 0 1-1.197 1.197l-10.7 5.836a3 3 0 0 1-4.303-3.516l1.524-4.954-1.524-4.954a3 3 0 0 1 4.303-3.516l10.7 5.836a3 3 0 0 1 1.197 4.07Zm-1.756-.958a1 1 0 0 0-.3-1.295l-.099-.062-10.7-5.836a1 1 0 0 0-1.462 1.059l.028.113 1.449 4.71h5.256a1 1 0 0 1 .117 1.992l-.117.007h-5.359l-1.346 4.375a1 1 0 0 0 1.329 1.222l.106-.05 10.7-5.836a1 1 0 0 0 .398-.4Z",fill:"#fff"},null,-1),Cs=[Is,ys];function $s(Q,E){return n(),l("svg",bs,[...Cs])}const As={render:$s},Ms={class:"system-container"},Ts={class:"system-message"},Gs=ie({__name:"system",props:{message:{}},setup(Q){const{t:E}=me.exports.useI18n(),G=pe(),c=Q,A=C(c.message),m=M=>{const{eventType:d,eventData:t}=M;switch(d){case Y.CHAT_GROUP_CREATED:{let r;t.masterName?r=t.masterName:r=G.filterMemberInfoByUserId(t.masterId).name;let v;if(t.names)v=t.names;else{const U=t.userIds.map(k=>G.memberList.find(R=>R.userId===k)).filter(Boolean);v=W(U,"name").join("\u3001")}return`${r} ${E("message.invite.join.group.menu.invite")} ${v} ${E("message.chat.room.message.tips.create.group2")}`}case Y.CHAT_GROUP_INFO_UPDATED:{let r;return t.updatedName?r=t.updatedName:r=G.filterMemberInfoByUserId(t.updateUserId).name,`${r} ${E("message.chat.room.message.tips.update.group")}`}case Y.CHAT_GROUP_MEMBER_INVITED:{let r;t.invitorName?r=t.invitorName:r=G.filterMemberInfoByUserId(t.invitorUserId).name;let v;if(t.inviteeNames)v=t.inviteeNames;else{const U=t.inviteeUserIds.map(k=>G.memberList.find(R=>R.userId===k)).filter(Boolean);v=W(U,"name").join("\u3001")}return`${r} ${E("message.chat.room.message.tips.invite.group")} ${v} ${E("message.chat.room.message.tips.invite.group2")}`}case Y.CHAT_GROUP_MEMBER_REMOVED:{let r;t.masterName?r=t.masterName:r=G.filterMemberInfoByUserId(t.masterId).name;let v;if(t.removedNames)v=t.removedNames;else{const U=t.removedUserIds.map(k=>G.memberList.find(R=>R.userId===k)).filter(Boolean);v=W(U,"name").join("\u3001")}return`${r} ${E("message.chat.room.message.tips.remove.group")} ${v}`}case Y.CHAT_GROUP_MASTER_CHANGED:{let r;t.oldMasterName?r=t.oldMasterName:r=G.filterMemberInfoByUserId(t.oldMasterId).name;let v;return t.newMasterName?v=t.newMasterName:v=G.filterMemberInfoByUserId(t.newMasterId).name,`${r} ${E("message.chat.room.message.tips.change.group")} ${v}`}case Y.CHAT_GROUP_DISBANDED:{let r;return t.masterName?r=t.masterName:r=G.filterMemberInfoByUserId(t.masterId).name,`${r} ${E("message.chat.room.message.tips.disbanded.group")}`}case Y.CHAT_GROUP_MEMBER_QUIT:{let r;return t.quitName?r=t.quitName:r=G.filterMemberInfoByUserId(t.quitUserId).name,`${r} ${E("message.chat.room.message.tips.quit.group")}`}default:return M}};return ht(()=>{A.value=c.message}),(M,d)=>(n(),l("div",Ms,[e("div",Ts,[e("span",null,f(m(A.value)),1)])]))}});const ks=re(Gs,[["__scopeId","data-v-909e595d"]]),Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAL9JREFUOE9j3L//PoeQJMtkBob/IQwMjAIM+MB/hi8MjP/nvHv+t5Lx4o1H/Qz/GVXYGBgTNDVl3uLTd/3JE+FfX/8vYPjP8ILx4o3Hn9n+MyoQ0gQz8MzNmyIs/zlvgzT+19eQZcTrRDRJkJ5RjThCbMAC59H731++q5qYqL8hJi5BCYD1H9d9UDzOZvjPIPH767dEQprPnLkpwsrNNZ+B8f8dRkgiZ25nYGBMYWBg4MGfxv9/YGRgXPPu+Z9cANw1hWlIktI3AAAAAElFTkSuQmCC",qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAAXNSR0IArs4c6QAAAQpJREFUOE+d0j1LQlEYwPH/c25DSx+hSSKpxU1sk7ulW1hDZE5eB6PNoUERBwcncVJocQkCp96WPoARfYGWoJZcQhwMQn1CJezlivd2tsM5v/O8nEcALEeTCjlgc7xfsF4EisO6nIrl6LbC1SLx+1yEPTFpbSIc+MUq3IzxOULCN1YePOPDCJzdw8dgGka94lYG7CCs56HTm4NXluEyC7kW3D1NL10fQSQA4TI8dmbF/Ym8ZEF1F1JbEKtBPg6hVQiV4PntZ1dc07YMVHbg2IbuO2wUZql+53NrNgLZKDTb0O27/4PnhrnxL/y/IYELwVHbwK3fIRkp+zJBGU0Z5QRY8/DI60gp0JDGJ7LiaVUfadx2AAAAAElFTkSuQmCC",Ns={class:"remove-modal-container"},Ss=["src"],Es={class:"remove-m-t"},ws={class:"remove-m-s"},Us={class:"remove-m-m wsl-scroll"},Ds=["onClick"],Os={class:"remove-m-m-i-l"},Rs=["src"],Bs={class:"remove-m-m-i-r"},Ls={class:"remove-m-m-i-rl"},Hs=["src"],xs={class:"remove-m-m-i-rr"},Ps={class:"remove-m-m-i-rr-t"},Vs={class:"remove-m-m-i-rr-b"},Fs={class:"remove-m-b"},Qs={class:"remove-m-b-l"},js=["src"],Js={class:"remove-m-b-r"},Ys=ie({__name:"remove",props:{members:{}},emits:["handleClose","handleSureRemove"],setup(Q,{emit:E}){const G=pe(),c=E,{t:A}=me.exports.useI18n(),m=()=>{c("handleClose")},M=Q,d=C([]),t=p=>d.value.some(a=>a.userId===p),r=p=>{const a=d.value.findIndex(h=>h.userId===p.userId);a===-1?d.value.push(p):d.value.splice(a,1)},v=C(20),U=p=>({zIndex:p,left:`${p*v.value}px`}),k=C([]),R=C({condition:""}),P=()=>{if(!R.value.condition)return M.members;const p=R.value.condition.toLowerCase();return M.members.filter(a=>a.name.toLowerCase().includes(p))},V=()=>{k.value=P(),console.log("\u67E5\u8BE2\u4EBA\u5458\u4E8B\u4EF6",k.value)},K=p=>{const a=C("");return p.pcOnline||p.androidOnline||p.glassOnline?a.value="online":a.value="outline",a.value},T=()=>{d.value&&d.value.length>0?c("handleSureRemove",d.value):x.warning(A("message.invite.join.group.select.psn.warning"))},N=()=>{d.value=[]};return he(()=>{V()}),fe(()=>{N()}),(p,a)=>{const h=we,J=Ae;return n(),l("div",Ns,[e("div",{class:"remove-fixed",onClick:m},[e("img",{src:s(Me),alt:""},null,8,Ss)]),e("div",Es,f(p.$t("meeting.select.tr.title")),1),e("div",ws,[y(J,{modelValue:R.value.condition,"onUpdate:modelValue":a[0]||(a[0]=g=>R.value.condition=g),class:"search-input",onInput:V},{prefix:O(()=>[y(h)]),_:1},8,["modelValue"])]),e("div",Us,[(n(!0),l(F,null,ee(k.value,(g,$)=>(n(),l("div",{key:`invite_psn_${$}_${g.userId}`,class:"remove-m-m-i",onClick:u=>r(g)},[e("div",Os,[e("img",{src:t(g.userId)?s(qe):s(Ke),alt:"avatar"},null,8,Rs)]),e("div",Bs,[e("div",Ls,[e("img",{src:g.avatarUrl,alt:""},null,8,Hs),e("div",{class:oe(["remove-m-m-i-rl-s",K(g)])},null,2)]),e("div",xs,[e("div",Ps,[e("span",null,f(g.name),1)]),e("div",Vs,[e("span",null,f(g.alias),1)])])])],8,Ds))),128))]),e("div",Fs,[e("div",Qs,[(n(!0),l(F,null,ee(d.value,(g,$)=>(n(),l(F,{key:`invite_m_icon_${$}`},[$<s(G).limitMember?(n(),l("div",{key:0,class:"remove-m-b-l-i",style:Ee(U($))},[e("img",{src:g.avatarUrl,alt:""},null,8,js)],4)):D("",!0)],64))),128))]),e("div",Js,[e("div",{class:"remove-m-b-r-btn",onClick:T},[e("span",null,f(s(A)("meeting.menu.btn.remove")),1)])])])])}}});const zs=re(Ys,[["__scopeId","data-v-7c724d57"]]),Zs={class:"invite-join-group-modal-container"},Ks=["src"],qs={class:"invite-m-t"},Xs={class:"invite-m-tabs"},Ws={class:"invite-m-tabs-main"},en={class:"invite-m-s"},tn={class:"invite-m-main wsl-scroll"},sn=["onClick"],nn={class:"invite-m-main-i-l"},on={class:"invite-m-main-i-r"},an={class:"invite-m-main-i-rl"},rn=["src"],ln={class:"invite-m-main-i-rr"},cn={class:"invite-m-main-i-rr-t"},dn={class:"invite-m-main-i-rr-b"},un=["onClick"],mn={class:"header-main-left"},pn={class:"header-main-left-i"},vn=["src"],_n={class:"header-main-title"},gn={class:"invite-main-group-body"},hn=["onClick"],fn={class:"invite-m-main-i-l"},bn={class:"invite-m-main-i-r"},In={class:"invite-m-main-i-rl"},yn=["src"],Cn={class:"invite-m-main-i-rr"},$n={class:"invite-m-main-i-rr-t"},An={class:"invite-m-main-i-rr-b"},Mn={class:"invite-m-bot"},Tn={class:"invite-m-bot-l"},Gn=["src"],kn={class:"invite-m-bot-r"},Nn=ie({__name:"invite-join-group",props:{members:{},groupMembers:{}},emits:["handleClose","handleInvite"],setup(Q,{emit:E}){const G=Q,c=C(G.members),A=C(G.groupMembers),m=pe(),M=E,{t:d}=me.exports.useI18n(),t=()=>{M("handleClose")},r=C({condition:""}),v=C(1),U=C({}),k=_=>{U.value[_]=!U.value[_]},R=_=>{const I=C("");switch(_.role){case 1:I.value=d("meeting.invite.psn.type.normal");break;case 2:I.value=d("meeting.invite.psn.type.product");break;case 3:I.value=d("meeting.invite.psn.type.technology");break;case 4:I.value=d("meeting.invite.psn.type.super");break}return I.value},P=_=>{const I=C("");return _.pcOnline||_.androidOnline||_.glassOnline?I.value="online":I.value="outline",I.value},V=C(20),K=_=>({zIndex:_,left:`${_*V.value}px`}),T=()=>{if(!r.value.condition)return G.members;const _=r.value.condition.toLowerCase();return G.members.filter(I=>I.name.toLowerCase().includes(_))},N=async()=>{if(!r.value.condition)return G.groupMembers;const _=r.value.condition.toLowerCase();return G.groupMembers.map(I=>({...I,contacts:I.contacts.filter(z=>z.name.toLowerCase().includes(_))})).filter(I=>I.contacts.length>0)},p=async()=>{v.value===1?c.value=T():v.value===2&&(A.value=await N())},a=_=>{v.value=_,r.value.condition="",p()},h=C([]),J=_=>h.value.some(I=>I.userId===_),g=_=>{const I=h.value.findIndex(z=>z.userId===_.userId);I===-1?h.value.push(_):h.value.splice(I,1)},$=()=>{h.value&&h.value.length>0?M("handleInvite",h.value):x.warning(d("message.invite.join.group.select.psn.warning"))},u=()=>{h.value=[]};return he(()=>{p()}),fe(()=>{u()}),(_,I)=>{const z=we,se=Ae;return n(),l("div",Zs,[e("div",{class:"invite-fixed",onClick:t},[e("img",{src:s(Me),alt:""},null,8,Ks)]),e("div",qs,f(_.$t("message.invite.join.group.title")),1),e("div",Xs,[e("div",Ws,[e("div",{class:oe(["invite-m-tabs-i",v.value===1?"active":""]),onClick:I[0]||(I[0]=L=>a(1))},[e("span",null,f(_.$t("message.invite.join.group.tabs.all")),1)],2),e("div",{class:oe(["invite-m-tabs-i",v.value===2?"active":""]),onClick:I[1]||(I[1]=L=>a(2))},[e("span",null,f(_.$t("message.invite.join.group.tabs.group")),1)],2)])]),e("div",en,[y(se,{modelValue:r.value.condition,"onUpdate:modelValue":I[2]||(I[2]=L=>r.value.condition=L),class:"search-input",onInput:p},{prefix:O(()=>[y(z)]),_:1},8,["modelValue"])]),e("div",tn,[v.value===1?(n(!0),l(F,{key:0},ee(c.value,(L,q)=>(n(),l("div",{key:`psn_${q}_${L.userId}`,class:"invite-m-main-i",onClick:j=>g(L)},[e("div",nn,[J(L.userId)?(n(),B(s(Qe),{key:0})):(n(),B(s(je),{key:1}))]),e("div",on,[e("div",an,[e("img",{src:L.avatarUrl,alt:""},null,8,rn),e("div",{class:oe(["invite-m-main-i-rl-s",P(L)])},null,2)]),e("div",ln,[e("div",cn,[e("span",null,f(L.name),1)]),e("div",dn,[e("span",null,f(R(L)),1)])])])],8,sn))),128)):D("",!0),v.value===2?(n(!0),l(F,{key:1},ee(A.value,(L,q)=>(n(),l("div",{key:`group_${q}`,class:"invite-m-main-group"},[e("div",{class:"invite-main-group-header",onClick:j=>k(q)},[e("div",mn,[e("div",pn,[e("img",{src:s(wt),alt:""},null,8,vn)]),e("div",_n,[e("span",null,f(L.groupName)+" ("+f(L.contacts.length)+")",1)])]),e("div",{class:oe(["header-main-right",{"rotate-icon":U.value[q]}])},[y(s(Ut))],2)],8,un),ft(e("div",gn,[(n(!0),l(F,null,ee(L.contacts,(j,le)=>(n(),l("div",{key:`group_psn_${le}_${j.userId}`,class:"invite-m-main-i",onClick:ae=>g(j)},[e("div",fn,[J(j.userId)?(n(),B(s(Qe),{key:0})):(n(),B(s(je),{key:1}))]),e("div",bn,[e("div",In,[e("img",{src:j.avatarUrl,alt:""},null,8,yn),e("div",{class:oe(["invite-m-main-i-rl-s",P(j)])},null,2)]),e("div",Cn,[e("div",$n,[e("span",null,f(j.name),1)]),e("div",An,[e("span",null,f(R(j)),1)])])])],8,hn))),128))],512),[[bt,U.value[q]]])]))),128)):D("",!0)]),e("div",Mn,[e("div",Tn,[(n(!0),l(F,null,ee(h.value,(L,q)=>(n(),l(F,{key:`invite_m_icon_${q}`},[q<s(m).showLimitMember?(n(),l("div",{key:0,class:"invite-m-bot-l-i",style:Ee(K(q))},[e("img",{src:L.avatarUrl,alt:""},null,8,Gn)],4)):D("",!0)],64))),128))]),e("div",kn,[e("div",{class:"invite-m-bot-r-btn",onClick:$},[e("span",null,f(s(d)("message.invite.join.group.menu.invite")),1)])])])])}}});const Sn=re(Nn,[["__scopeId","data-v-c35a03ed"]]);const En="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAAXNSR0IArs4c6QAAAStJREFUKFOdki1IQ2EUhp9zGduCYaBhTSxiMBgEkzCDIBZvM1huunfNHzD4U4QLq84wvMNgsQgDw4JJByaDRQxiMxgEw4LBgXxH7ub129gG6hfPd57z977CP570Mb6OOQ4lDEvAhTGEnMhrd56FCppyJlkH9hFyXUnvJo61iDiVjzjegTzNS5prEaaGTavwoMoCVXlrQ46vAcJxAmwtQsmF7RocXdkyRilSlagDBRqPdZh814rgzkD9HlYqPb03TCTlgdD4KKzOwtktvDR/AWVTsLsMcxNw9wwHdWh9/oC2E74GzvdOwTxU1mz1zXO7V89OeJqTDDcC00OvpzyqoRBrZnXyNEuGQCAUGElgVZoKIU+UaUh70H5HeJonzZ6Aq3AJ7MTaDHbEHzz4BWPfYg4WmCA2AAAAAElFTkSuQmCC",wn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHFJREFUSEtjZKAxYKSx+QyjFhAMYZKC6MSZG/kgEy1MNCYSNBmqgFQL9kMtcBy1AGsInDhzY4gEETS1BGB4g5HRACz2//8FLF7cgC11YU1FNLcAVxIcOnEw6gPkECC1LKJtYUdsAUe2D0YtICcECOoBAKnhQBlcrxl4AAAAAElFTkSuQmCC",Un="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFBJREFUSEtjZKAxYKSx+QyjFhAM4dEgGg0igiFAUAHWVHTizI18BgaGAIK6URVssDDRmIiuZ2AsINHleJWPZjSCoTkaRKNBRDAECCqgeSoCACxGChn+C3lNAAAAAElFTkSuQmCC",Dn={class:"group-container"},On={class:"group-container-top"},Rn={class:"group-container-top-left"},Bn=["src"],Ln={class:"group-container-main"},Hn={class:"group-container-main-top"},xn={class:"group-container-main-top-left"},Pn=["src"],Vn={class:"group-container-main-top-right"},Fn={class:"group-container-main-top-right-n"},Qn={class:"group-container-main-divider"},jn={class:"group-container-main-mid"},Jn={class:"group-container-main-mid-top"},Yn={class:"group-container-main-mid-body wsl-scroll"},zn={class:"group-container-main-mid-body-item-top"},Zn=["src"],Kn={key:0,class:"group-container-main-mid-body-item-top-fixed"},qn=["src"],Xn={class:"group-container-main-mid-body-item-bot"},Wn={key:"group_add",class:"group-container-main-mid-body-item"},eo=["src"],to={key:"group_layoff",class:"group-container-main-mid-body-item"},so=["src"],no={class:"group-container-main-divider"},oo={class:"group-container-main-menu"},ao=ie({__name:"group-setting",emits:["handleClose","handleRemoveGroup","handleInviteJoinGroup","handleTransferOpen","handleSureExitGroup","handleSureDisbandGroup"],setup(Q,{emit:E}){const{t:G}=me.exports.useI18n(),c=Se(),A=Ye(),m=E,M=()=>{m("handleClose")},d=C(),t=C(!1),r=()=>{t.value=!0,setTimeout(()=>{d==null||d.value.focus()},100)},v=()=>{c.updateCurConversation({...c.curConversation,targetName:c.curGroupDetail.groupName}),c.conversationList.forEach(T=>{T.targetId===c.curGroupDetail.groupId&&(T.targetName=c.curGroupDetail.groupName)})},U=async()=>{if(!c.curGroupDetail.groupName){x.error(G("message.chat.group.revamp.name.tips"));return}const T=await c.revampGroupName({groupId:c.curGroupDetail.groupId,groupName:c.curGroupDetail.groupName});if(T.code!==200&&T.code!==401){x.error(T.msg);return}x.success(G("message.chat.group.revamp.name")),t.value=!1,v()},k=()=>{m("handleRemoveGroup")},R=()=>{m("handleInviteJoinGroup")},P=()=>{m("handleTransferOpen")},V=()=>{m("handleSureExitGroup")},K=()=>{m("handleSureDisbandGroup")};return(T,N)=>{const p=$e,a=Ze,h=It,J=Ae,g=yt,$=Ct;return n(),l("div",Dn,[e("div",On,[e("div",Rn,[e("span",null,f(T.$t("message.chat.group.title")),1)]),e("div",{class:"group-container-top-right",onClick:M},[e("img",{src:s(Me),alt:""},null,8,Bn)])]),y(p,{margin:0}),e("div",Ln,[e("div",Hn,[e("div",xn,[e("img",{src:s(c).curGroupDetail.avatarUrl,alt:""},null,8,Pn)]),e("div",Vn,[t.value?(n(),B(J,{key:1,ref_key:"GroupInfoNameRef",ref:d,modelValue:s(c).curGroupDetail.groupName,"onUpdate:modelValue":N[0]||(N[0]=u=>s(c).curGroupDetail.groupName=u),onBlur:U},null,8,["modelValue"])):(n(),l(F,{key:0},[y(a,{content:s(c).curGroupDetail.groupName},{default:O(()=>[e("div",Fn,f(s(c).curGroupDetail.groupName),1)]),_:1},8,["content"]),y(a,{content:s(G)("message.chat.group.revamp.name.btn")},{default:O(()=>[s(c).curGroupDetail.masterId===s(A).userId?(n(),B(h,{key:0,onClick:r})):D("",!0)]),_:1},8,["content"])],64))])]),e("div",Qn,[y(p,{margin:0})]),e("div",jn,[e("div",Jn,f(T.$t("message.chat.group.mid.top"))+" ("+f(s(c).curGroupDetail.members.length)+f(T.$t("message.chat.group.mid.dw"))+") ",1),e("div",Yn,[(n(!0),l(F,null,ee(s(c).curGroupDetail.members,(u,_)=>(n(),l("div",{key:`group_psn_${_}_${u.userId}`,class:"group-container-main-mid-body-item"},[e("div",zn,[e("img",{src:u.avatarUrl,alt:""},null,8,Zn),u.isMaster==1?(n(),l("div",Kn,[y(a,{content:T.$t("message.chat.group.owner")},{default:O(()=>[e("img",{src:s(En),alt:""},null,8,qn)]),_:1},8,["content"])])):D("",!0)]),y(a,{content:u.name},{default:O(()=>[e("div",Xn,f(u.name),1)]),_:2},1032,["content"])]))),128)),e("div",Wn,[e("div",{class:"group-container-main-mid-body-item-top btn",onClick:R},[e("img",{src:s(wn),alt:""},null,8,eo)])]),s(c).curGroupDetail.masterId===s(A).userId?(n(),l("div",to,[e("div",{class:"group-container-main-mid-body-item-top btn",onClick:k},[e("img",{src:s(Un),alt:""},null,8,so)])])):D("",!0)])]),e("div",no,[y(p,{margin:0})]),e("div",oo,[s(c).curGroupDetail.masterId===s(A).userId?(n(),B(g,{key:0,onClick:P},{default:O(()=>[e("span",null,f(T.$t("meeting.menu.btn.transfer")),1)]),_:1})):D("",!0),s(c).curGroupDetail.masterId===s(A).userId?(n(),B($,{key:1,content:`${T.$t("message.chat.group.js.tips")}`,type:"warning","ok-text":T.$t("message.chat.group.exit.ok"),"cancel-text":T.$t("message.chat.group.exit.cancel"),onOk:K},{default:O(()=>[y(g,{type:"primary",status:"danger"},{default:O(()=>[e("span",null,f(T.$t("message.chat.group.js.btn")),1)]),_:1})]),_:1},8,["content","ok-text","cancel-text"])):(n(),B($,{key:2,content:`${T.$t("message.chat.group.exit.tips")}`,type:"warning","ok-text":T.$t("message.chat.group.exit.ok"),"cancel-text":T.$t("message.chat.group.exit.cancel"),onOk:V},{default:O(()=>[y(g,{type:"primary",status:"danger"},{default:O(()=>[e("span",null,f(T.$t("meeting.menu.btn.exit")),1)]),_:1})]),_:1},8,["content","ok-text","cancel-text"]))])])])}}});const ro=re(ao,[["__scopeId","data-v-5413673f"]]),io={class:"transfer-modal-container"},lo=["src"],co={class:"transfer-m-t"},uo={class:"transfer-m-s"},mo={class:"transfer-m-m wsl-scroll"},po=["onClick"],vo={class:"transfer-m-m-i-l"},_o=["src"],go={class:"transfer-m-m-i-r"},ho={class:"transfer-m-m-i-rl"},fo=["src"],bo={class:"transfer-m-m-i-rr"},Io={class:"transfer-m-m-i-rr-t"},yo={class:"transfer-m-m-i-rr-b"},Co={class:"transfer-m-b"},$o={class:"transfer-m-b-l"},Ao=["src"],Mo={class:"transfer-m-b-r"},To=ie({__name:"transfer",props:{members:{}},emits:["handleClose","handleSureTransfer"],setup(Q,{emit:E}){const G=pe(),c=E,{t:A}=me.exports.useI18n(),m=()=>{c("handleClose")},M=Q,d=C([]),t=a=>d.value.some(h=>h.userId===a),r=a=>{d.value=[a]},v=C(20),U=a=>({zIndex:a,left:`${a*v.value}px`}),k=C([]),R=C({condition:""}),P=()=>{if(!R.value.condition)return M.members;const a=R.value.condition.toLowerCase();return M.members.filter(h=>h.name.toLowerCase().includes(a))},V=()=>{console.log("\u67E5\u8BE2\u4EBA\u5458\u4E8B\u4EF6"),k.value=P()},K=a=>{const h=C("");return a.pcOnline||a.androidOnline||a.glassOnline?h.value="online":h.value="outline",h.value},T=a=>{const h=C("");switch(a.role){case 1:h.value=A("meeting.invite.psn.type.normal");break;case 2:h.value=A("meeting.invite.psn.type.product");break;case 3:h.value=A("meeting.invite.psn.type.technology");break;case 4:h.value=A("meeting.invite.psn.type.super");break}return h.value},N=()=>{c("handleSureTransfer",d.value)},p=()=>{d.value=[]};return he(()=>{V()}),fe(()=>{p()}),(a,h)=>{const J=we,g=Ae;return n(),l("div",io,[e("div",{class:"transfer-fixed",onClick:m},[e("img",{src:s(Me),alt:""},null,8,lo)]),e("div",co,f(a.$t("message.chat.group.transfer.title")),1),e("div",uo,[y(g,{modelValue:R.value.condition,"onUpdate:modelValue":h[0]||(h[0]=$=>R.value.condition=$),class:"search-input",onInput:V},{prefix:O(()=>[y(J)]),_:1},8,["modelValue"])]),e("div",mo,[(n(!0),l(F,null,ee(k.value,($,u)=>(n(),l("div",{key:`invite_psn_${u}_${$.userId}`,class:"transfer-m-m-i",onClick:_=>r($)},[e("div",vo,[e("img",{src:t($.userId)?s(qe):s(Ke),alt:"avatar"},null,8,_o)]),e("div",go,[e("div",ho,[e("img",{src:$.avatarUrl,alt:""},null,8,fo),e("div",{class:oe(["transfer-m-m-i-rl-s",K($)])},null,2)]),e("div",bo,[e("div",Io,[e("span",null,f($.name),1)]),e("div",yo,[e("span",null,f(T($)),1)])])])],8,po))),128))]),e("div",Co,[e("div",$o,[(n(!0),l(F,null,ee(d.value,($,u)=>(n(),l(F,{key:`invite_m_icon_${u}`},[u<s(G).limitMember?(n(),l("div",{key:0,class:"transfer-m-b-l-i",style:Ee(U(u))},[e("img",{src:$.avatarUrl,alt:""},null,8,Ao)],4)):D("",!0)],64))),128))]),e("div",Mo,[e("div",{class:"transfer-m-b-r-btn",onClick:N},[e("span",null,f(s(A)("message.chat.group.transfer.btn")),1)])])])])}}});const Go=re(To,[["__scopeId","data-v-79a04b20"]]),ko={key:0,class:"detail-panel"},No={class:"detail-panel-top"},So={class:"detail-panel-top-title"},Eo={class:"detail-panel-top-title-left"},wo=["src"],Uo={class:"detail-panel-top-title-right textEllipsis"},Do={key:0,class:"detail-panel-top-title-right"},Oo={class:"detail-panel-top-btn"},Ro={class:"detail-panel-main"},Bo={class:"detail-panel-main-left"},Lo={class:"chat-c-m-i-i-l"},Ho=["src"],xo={class:"chat-c-m-i-r"},Po={class:"chat-c-m-i-r-t"},Vo={class:"name"},Fo={class:"time"},Qo={class:"chat-c-m-i-r-m"},jo={key:0,class:"chat-c-m-i-r-m-l"},Jo={key:1,class:"chat-c-m-i-r-m-l"},Yo={class:"chat-c-m-i-r-m-b"},zo={key:0,class:"detail-panel-main-left-send"},Zo={key:1,class:"detail-panel-main-left-no"},Ko={key:0,class:"detail-panel-main-right"},qo={key:1,class:"no-data"},Xo={class:"no-data-body"},Wo=["src"],ea={class:"no-data-body-text"},ta="ChatDB",sa=ie({__name:"detail",setup(Q){const{addMessage:E,getAllMessages:G,updateMessageByFingerPrint:c,updateConversations:A}=Je(ta),m=dt(),M=ut(),d=pe(),t=Se(),r=Ye(),v=mt(),{locale:U,t:k}=me.exports.useI18n(),R=o=>JSON.parse(o),P=C(null),V=$t(()=>t.messageList),K=async o=>{o||await St(1e3*.5),kt(()=>{P.value&&P.value.scrollTo({top:P.value.scrollHeight,behavior:"smooth"})})},T=async()=>{if(!t.curConversation||!t.curConversation.conversationId)return;const o=await G(t.curConversation.conversationId);o.forEach(i=>{i.status===1&&c(i.fingerPrint,{...i,status:2})}),t.updateMessageList(Ne(o)),K()},N=o=>{const i=Ce(),b=Ce(o),S=b.format("YYYY-MM-DD HH:mm");return b.isSame(i,"day")?`${k("today")} ${b.format("HH:mm")}`:b.isSame(i.add(1,"day"),"day")?`${k("tomorrow")} ${b.format("HH:mm")}`:b.isSame(i.subtract(1,"day"),"day")?`${k("yesterday")} ${b.format("HH:mm")}`:S},p=C(""),a=async()=>{try{if(p.value.trim()!==""){const o=pt(),i=Date.now(),b={fingerPrint:o,chatType:t.curConversation.chatType,recipientId:t.curConversation.targetId,name:r.name,avatarUrl:r.avatarUrl,parentId:`${t.curConversation.chatType}_${t.curConversation.targetId}`,senderId:r.userId,messageType:ye.TEXT,content:p.value.trim(),sendTime:i,status:1};await E(b,!1),H.emit("ChatSendMessage",{fingerPrint:o,recipientId:t.curConversation.targetId,chatType:t.curConversation.chatType,messageType:ye.TEXT,content:p.value.trim()}),p.value="",H.emit("send-refresh-chat-room"),K(!0)}}catch(o){console.error("Error adding chat session:",o)}},h=Nt(a,1e3),J=o=>{o.key==="Enter"&&o.ctrlKey?p.value+=`
`:o.key==="Enter"&&(o.preventDefault(),a())},g=C(!1),$=C(!1),u=()=>{m.updateRoomOptions(null),m.updateRoomInvitePsn(null),g.value=!1},_=o=>{g.value=!0,m.updateRoomInvitePsn(o),m.updateRoomOptions({meetingName:`${r.name} ${k("meeting.room.option.meetingName")}`,video:!1,audio:!0,loudspeaker:!0,cloudRecord:!1,escaping:!1,abstract:!1,organizer:r.name})},I=async o=>{var i,b,S,X;try{const Z=await m.ThImEvent.joinMeeting({meetingNo:o.meetingNo,forceEntryStatus:0,inviters:W(m.roomInvitePsn,"userId")});if(M.updateRoomTranslateInfo({...M.roomTranslateInfo,...Z.data,open:!!((i=Z.data)!=null&&i.enableTranslation)}),v.updateBtnLoading(!1),Z.code!==200&&Z.code!==401){Z.code===Fe.OTHER_CLIENT_JOINED_MEETING||Z.code===Fe.OTHER_CLIENT_IN_MEETING?H.emit("Chat-Other-Client-Joined-Meeting"):x.error(Z.msg);return}m.ThImEvent.roomMenuOptions={video:(b=m.roomOptions)==null?void 0:b.video,audio:(S=m.roomOptions)==null?void 0:S.audio,loudspeaker:(X=m.roomOptions)==null?void 0:X.loudspeaker},m.ThImEvent.setRoomOnlineListPsn(d.memberList),m.ThImEvent.setRoomOnlineGroupPsn(d.memberGroupList),u(),m.updateAssistVisible(!0)}catch{v.updateBtnLoading(!1)}},z=async()=>{var o,i,b,S,X,Z,be;try{const ue=await m.createRealtimeMeeting({aiStatus:(o=m.roomOptions)!=null&&o.abstract?"1":"0",recordStatus:(i=m.roomOptions)!=null&&i.cloudRecord?"1":"0",escaping:(b=m.roomOptions)!=null&&b.escaping?"1":"0",subject:(S=m.roomOptions)==null?void 0:S.meetingName,userIds:W(m.roomInvitePsn,"userId"),enableTranslation:(X=m.roomOptions)!=null&&X.escaping?"1":"0",languageType:(Z=M.roomTranslateInfo)==null?void 0:Z.languageType,industryType:(be=M.roomTranslateInfo)==null?void 0:be.industryType});if(ue.code!==200&&ue.code!==401){v.updateBtnLoading(!1),x.error(ue.msg);return}I(ue.data)}catch{v.updateBtnLoading(!1)}},se=()=>{if(m.answerInfo&&m.answerInfo.meetingNo){x.error(k("meeting.call.message.tips"));return}t.curConversation.chatType===te.PRIVATE_CHAT?_([{userId:t.curConversation.targetId,name:t.curConversation.name}]):t.curConversation.chatType===te.GROUP_CHAT&&($.value=!0)},L=()=>{$.value=!1},q=o=>{L(),_(o)},j=C(null),le=C(null),ae=C(!1),ve=C(!0),ne=async()=>{if(await T(),!t.curConversation||t.curConversation.chatType!==te.GROUP_CHAT)return;const o=await t.getGroupDetail({groupId:t.curConversation.targetId});if(o.code!==200&&o.code!==401){x.error(o.msg),o.code===20201&&(ve.value=!1);return}o.data.status===1?ve.value=!1:ve.value=!0;const i=o.data.members;await d.memberList.forEach(b=>{const S=i.find(X=>X.userId===b.userId);S&&(S.pcOnline=b.pcOnline,S.glassOnline=b.glassOnline,S.androidOnline=b.androidOnline)}),i.sort((b,S)=>{const X=b.pcOnline||b.glassOnline||b.androidOnline?1:0;return(S.pcOnline||S.glassOnline||S.androidOnline?1:0)-X}),t.updateCurGroupDetail({...o.data,members:i})},Ue=()=>{t.curConversation.chatType!==te.GROUP_CHAT?(j.value=d.memberList,le.value=d.memberGroupList):t.curGroupDetail&&t.curGroupDetail.members?(j.value=d.filterMembersNotInList(t.curGroupDetail.members,d.memberList),le.value=d.filterMembersNotInGroups(t.curGroupDetail.members,d.memberGroupList)):(j.value=d.memberList,le.value=d.memberGroupList),ae.value=!0},_e=()=>{ae.value=!1,j.value=null,le.value=null},Xe=async o=>{if(t.curConversation.chatType===te.GROUP_CHAT){const i=await t.inviteGroupMember({groupId:t.curGroupDetail.groupId,userIds:W(o,"userId")});if(i.code!==200&&i.code!==401){x.error(i.msg);return}ne(),_e()}else if(o.length>0){let b=W(o,"name").join("\u3001");b=b.length>50?`${b.substring(0,46)}...`:b;const S=await t.createGroup({groupName:b,userIds:W(o,"userId")});if(S.code!==200&&S.code!==401){x.error(S.msg);return}x.success(k("meeting.member.create.group.success")),t.updateCurConversation({targetId:S.data.groupId,targetName:S.data.groupName,chatType:te.GROUP_CHAT,conversationId:`${te.GROUP_CHAT}_${S.data.groupId}`,targetAvatarUrl:S.data.avatarUrl}),ne(),_e()}else x.warning(k("message.invite.join.group.select.psn.warning"))},We=async()=>{t.updateGroupChatSettingVisible(!0)},De=()=>{t.updateGroupChatSettingVisible(!1)},ce=C(!1),et=()=>{ce.value=!0},Te=()=>{ce.value=!1},tt=async o=>{const i=await t.removeGroupMember({groupId:t.curGroupDetail.groupId,userIds:W(o,"userId")});if(i.code!==200&&i.code!==401){x.error(i.msg);return}ne(),Te()},de=C(!1),st=()=>{de.value=!0},Ge=()=>{de.value=!1},nt=async o=>{const i=await t.transferGroupMaster({groupId:t.curGroupDetail.groupId,userId:o[0].userId});if(i.code!==200&&i.code!==401){x.error(i.msg);return}Ge(),ne()},ot=async()=>{const o=await t.leaveGroup({groupId:t.curGroupDetail.groupId});if(o.code!==200&&o.code!==401){x.error(o.msg);return}ne(),_e(),H.emit("event-exit-group-chat")},at=async()=>{const o=await t.disbandGroup({groupId:t.curGroupDetail.groupId});if(o.code!==200&&o.code!==401){x.error(o.msg);return}H.emit("event-disband-group-chat")},Oe=(o,i)=>d.filterMemberInfoByUserId(o.senderId)[i],Re=async o=>{const{fp:i,status:b}=o;console.log("\u4F1A\u8BDD\u4E2D\u6D88\u606F\u72B6\u6001\u53D8\u66F4-handleChatMessageStatus",i,b),await c(i,{status:b?0:2}),T()},rt=()=>{H.on("group-info-change",ne),H.on("ChatMessageStatus",Re)},it=()=>{H.off("group-info-change",ne),H.off("ChatMessageStatus",Re)},lt=()=>{t.groupChatSettingVisible&&De(),g.value&&u(),$.value&&L(),ae.value&&_e(),ce.value&&Te(),de.value&&Ge()};return he(()=>{console.log("\u8BE6\u60C5\u9875\u9762-updateConversations",t.curConversation),t.curConversation&&A({...Ne(t.curConversation),unreadCount:0}),ne(),rt()}),fe(()=>{lt(),it()}),ke(()=>U,()=>{T()},{deep:!0}),ke(()=>t.curConversation,()=>{console.log("\u76D1\u542C\u4F1A\u8BDD\u53D8\u66F4"),ne()},{deep:!0}),(o,i)=>{const b=Ze,S=At,X=$e,Z=Mt,be=vt,ue=Tt,ge=Gt,ct=ze;return n(),B(ct,{bordered:!1,class:"message-detail-container","body-style":{padding:0,height:"100%"}},{default:O(()=>[s(t).curConversation?(n(),l("div",ko,[e("div",No,[e("div",So,[y(S,{size:16},{default:O(()=>{var w,Ie,Be,Le,He,xe,Pe;return[e("div",Eo,[e("img",{src:s(t).curConversation.chatType!==te.GROUP_CHAT?s(t).curConversation.targetAvatarUrl:(w=s(t).curGroupDetail)==null?void 0:w.avatarUrl,alt:""},null,8,wo)]),y(b,{position:"bottom",content:s(t).curConversation.chatType!==te.GROUP_CHAT?s(t).curConversation.targetName:(Ie=s(t).curGroupDetail)==null?void 0:Ie.groupName},{default:O(()=>{var Ve;return[e("div",Uo,[e("span",null,f(s(t).curConversation.chatType!==te.GROUP_CHAT?s(t).curConversation.targetName:(Ve=s(t).curGroupDetail)==null?void 0:Ve.groupName),1)])]}),_:1},8,["content"]),(Le=(Be=s(t))==null?void 0:Be.curGroupDetail)!=null&&Le.members?(n(),l("div",Do,[e("span",null,f(s(t).curConversation.chatType===1?`(${(Pe=(xe=(He=s(t))==null?void 0:He.curGroupDetail)==null?void 0:xe.members)==null?void 0:Pe.length})`:""),1)])):D("",!0)]}),_:1})]),e("div",Oo,[ve.value?(n(),B(S,{key:0,size:16},{default:O(()=>[y(b,{content:o.$t("meeting.tooltip.btn.send.meeting"),position:"bottom"},{default:O(()=>[e("div",{class:"detail-panel-top-btn-item",onClick:se},[y(s(is),{class:"svg-icon"})])]),_:1},8,["content"]),y(b,{position:"bottom",content:s(t).curConversation.chatType===1?o.$t("meeting.tooltip.btn.invite.member"):s(k)("message.chat.room.message.tips.create.group1")},{default:O(()=>[e("div",{class:"detail-panel-top-btn-item",onClick:Ue},[y(s(ms),{class:"svg-icon"})])]),_:1},8,["content"]),s(t).curConversation.chatType===1?(n(),B(b,{key:0,content:o.$t("meeting.tooltip.btn.group.setting"),position:"bottom"},{default:O(()=>[e("div",{class:"detail-panel-top-btn-item",onClick:We},[y(s(hs),{class:"svg-icon"})])]),_:1},8,["content"])):D("",!0)]),_:1})):D("",!0)])]),y(X,{margin:0}),e("div",Ro,[e("div",Bo,[e("div",{ref_key:"chatContainer",ref:P,class:"detail-panel-main-left-body wsl-scroll"},[(n(!0),l(F,null,ee(V.value,(w,Ie)=>(n(),l("div",{key:Ie,class:oe(["chat-c-m-i",w.senderId==s(r).userId?"my-message":"other-message"])},[w.messageType===ye.SYSTEM?(n(),B(ks,{key:0,message:R(w.content)},null,8,["message"])):(n(),l(F,{key:1},[e("div",Lo,[e("img",{src:Oe(w,"avatarUrl"),alt:"avatar",class:"avatar"},null,8,Ho)]),e("div",xo,[e("div",Po,[e("span",Vo,f(Oe(w,"name")),1),e("span",Fo,f(N(w.sendTime)),1)]),e("div",Qo,[w.status===1?(n(),l("div",jo,[y(Z)])):D("",!0),w.status===2?(n(),l("div",Jo,[y(be,{color:"red"})])):D("",!0),e("div",Yo,f(w.content),1)])])],64))],2))),128))],512),ve.value||s(t).curConversation.chatType===0?(n(),l("div",zo,[y(ue,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=w=>p.value=w),"auto-size":{minRows:2,maxRows:2},"max-length":s(v).textInputMaxLength,class:"ChatMessageSendTextarea",placeholder:o.$t("message.chat.text.placeholder"),onKeydown:J},null,8,["modelValue","max-length","placeholder"]),e("div",{class:"detail-panel-main-left-send-btn",onClick:i[1]||(i[1]=(...w)=>s(h)&&s(h)(...w))},[y(s(As))])])):(n(),l("div",Zo,[e("span",null,f(o.$t("message.chat.room.send.area.no")),1)]))]),y(X,{direction:"vertical",margin:0}),s(t).groupChatSettingVisible?(n(),l("div",Ko,[y(ro,{onHandleClose:De,onHandleRemoveGroup:et,onHandleInviteJoinGroup:Ue,onHandleTransferOpen:st,onHandleSureExitGroup:ot,onHandleSureDisbandGroup:at})])):D("",!0)])])):(n(),l("div",qo,[e("div",Xo,[e("img",{src:s(fs),alt:""},null,8,Wo),e("div",ea,f(o.$t("message.chat.detail.no.data")),1)])])),g.value?(n(),B(ge,{key:2,visible:g.value,"onUpdate:visible":i[2]||(i[2]=w=>g.value=w),footer:!1,closable:!1,class:"customModal"},{default:O(()=>[y(Et,{onHandleCall:z,onHandleClose:u})]),_:1},8,["visible"])):D("",!0),$.value?(n(),B(ge,{key:3,visible:$.value,"onUpdate:visible":i[3]||(i[3]=w=>$.value=w),footer:!1,closable:!1,class:"customModal"},{default:O(()=>[$.value?(n(),B(Dt,{key:0,"select-psn":[{userId:s(r).userId,name:s(r).name,avatarUrl:s(r).avatarUrl}],onHandleInvite:q,onHandleClose:L},null,8,["select-psn"])):D("",!0)]),_:1},8,["visible"])):D("",!0),ae.value?(n(),B(ge,{key:4,visible:ae.value,"onUpdate:visible":i[4]||(i[4]=w=>ae.value=w),footer:!1,closable:!1,class:"customModal"},{default:O(()=>[ae.value?(n(),B(Sn,{key:0,members:j.value,"group-members":le.value,onHandleInvite:Xe,onHandleClose:_e},null,8,["members","group-members"])):D("",!0)]),_:1},8,["visible"])):D("",!0),ce.value?(n(),B(ge,{key:5,visible:ce.value,"onUpdate:visible":i[5]||(i[5]=w=>ce.value=w),footer:!1,closable:!1,class:"customModal"},{default:O(()=>[ce.value?(n(),B(zs,{key:0,members:s(t).curGroupDetail.members,onHandleSureRemove:tt,onHandleClose:Te},null,8,["members"])):D("",!0)]),_:1},8,["visible"])):D("",!0),de.value?(n(),B(ge,{key:6,visible:de.value,"onUpdate:visible":i[6]||(i[6]=w=>de.value=w),footer:!1,closable:!1,class:"customModal"},{default:O(()=>[de.value?(n(),B(Go,{key:0,members:s(t).curGroupDetail.members,onHandleSureTransfer:nt,onHandleClose:Ge},null,8,["members"])):D("",!0)]),_:1},8,["visible"])):D("",!0)]),_:1})}}});const na=re(sa,[["__scopeId","data-v-08e98ea8"]]),oa={class:"container"},aa={class:"layout"},ra={class:"layout-left-side"},ia={class:"layout-content"},la=ie({__name:"index",setup(Q){return(E,G)=>{const c=$e;return n(),l("div",oa,[e("div",aa,[e("div",ra,[y(ss)]),y(c,{direction:"vertical",style:{margin:0}}),e("div",ia,[y(na)])])])}}});const fa=re(la,[["__scopeId","data-v-e8a9eebc"]]);export{fa as default};
